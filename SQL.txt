1) Get top 5 customer with highest total


SELECT TOP 5 c.CustomerID, c.CustomerName, SUM(o.OrderValue) AS TotalOrderValue
FROM Customers c
JOIN Orders o ON c.CustomerID = o.CustomerID
GROUP BY c.CustomerID, c.CustomerName
ORDER BY TotalOrderValue DESC;





2) Highest spend Customer of current month


SELECT c.CustomerId,c.CustomerName,SUM(o.TotalAmount) AS MonthlySpending
FROM Customers c
JOIN Orders o ON c.CustomerId = o.CustomerId
WHERE YEAR(o.OrderDate) = YEAR(GETDATE()) AND MONTH(o.OrderDate) = MONTH(GETDATE())
GROUP BY c.CustomerId, c.CustomerName
ORDER BY MonthlySpending DESC;




3) Latest order for every customer


SELECT o.OrderId,o.CustomerId,o.OrderDate,o.TotalAmount
FROM Orders o
INNER JOIN (SELECT CustomerId,MAX(OrderDate) AS LatestOrderDate
    FROM Orders GROUP BY CustomerId ) latest 
	ON o.CustomerId = latest.CustomerId AND o.OrderDate = latest.LatestOrderDate
ORDER BY o.CustomerId;




4)  Optimized Query:
  - We can use JOIN insted of IN
  - retrived only necessary data not full (*)


SELECT o.Id  
FROM Orders o
JOIN Customers c ON o.CustomerId = c.CustomerId
WHERE c.Country = 'USA';